# 🧪 完整功能测试指南

## 📋 测试前准备

### 1. 确认服务正在运行

**后端：**
```bash
# 应该看到：
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

**前端：**
```bash
# 应该看到：
✓ Ready in XX ms
```

访问：
- 后端API文档：http://localhost:8000/docs
- 前端应用：http://localhost:3000

---

## ✅ 功能测试清单

### 测试1：飞书登录

**步骤：**
1. 访问 http://localhost:3000
2. 点击"使用飞书登录"
3. 扫码或输入账号密码
4. 授权应用访问

**预期结果：**
- ✅ 成功跳转到文档列表页面
- ✅ 显示用户的飞书文档列表
- ✅ 文档按更新时间排序

---

### 测试2：查看文档列表

**步骤：**
1. 登录后自动显示文档列表

**预期结果：**
- ✅ 显示最近更新的文档
- ✅ 每个文档显示标题和更新时间
- ✅ 可以点击文档进入编辑页面

---

### 测试3：加载文档内容

**步骤：**
1. 点击一个**包含图片**的文档
2. 等待内容加载

**预期结果：**
- ✅ 左侧素材栏显示文本块和图片
- ✅ 图片能正常显示缩略图
- ✅ 中间区域显示"文档内容预览"
- ✅ 文本内容完整显示

---

### 测试4：AI首次生成（关键！）

**步骤：**
1. 在多行输入框中输入指令：
   ```
   根据图片内容，创作一篇产品介绍，把图片智能地插入到合适的位置
   ```
2. 点击"生成"按钮
3. 等待AI生成（约10-30秒）

**预期结果：**
- ✅ 显示加载动画
- ✅ 生成成功提示："文章生成成功！"
- ✅ 右侧显示生成的文章
- ✅ **图片自动显示**在文章中（不需要额外操作）
- ✅ 显示蓝色提示框："AI已分析图片内容..."

**关键检查点：**
- [ ] 图片是否显示？（不是占位符）
- [ ] 图片位置是否合理？
- [ ] 图片清晰度如何？

**如果图片不显示：**
→ 参考 `图片显示问题调试指南.md`

---

### 测试5：多轮对话（第2轮）

**步骤：**
1. 生成文章后，在输入框中输入：
   ```
   把第一张图片移到文章开头
   ```
2. 点击"发送"或按回车

**预期结果：**
- ✅ 不会出现500错误
- ✅ 文章更新成功
- ✅ 图片位置被调整
- ✅ 图片继续正常显示
- ✅ 提示："文章已更新！"

---

### 测试6：多轮对话（第3轮+）

继续精修，测试多轮对话：

**测试指令：**
```
为每张图片添加详细说明
```
```
把文章改得更专业一些
```
```
增加一个总结段落
```

**预期结果：**
- ✅ 每轮都能成功
- ✅ 不会500错误
- ✅ 图片持续显示

---

### 测试7：创建飞书副本（新功能！）

**步骤：**
1. 生成文章后，点击右上角**蓝色按钮**"创建飞书副本"
2. 等待创建（约5-15秒）
3. 看到成功提示弹窗

**预期结果：**
- ✅ 显示"正在创建飞书文档..."加载提示
- ✅ 成功后弹出提示框："飞书文档创建成功"
- ✅ 提示框中有链接："点击打开飞书文档"
- ✅ 点击链接，在新标签页中打开飞书文档

**在飞书中检查：**
- [ ] 文档标题：`原文档名 - AI创作副本`
- [ ] 文本内容完整
- [ ] **图片已导入并正确显示**
- [ ] 图片位置与AI排版一致
- [ ] 标题层级正确（一级、二级、三级）

---

### 测试8：复制功能

**步骤：**
1. 点击"复制"按钮
2. 粘贴到文本编辑器

**预期结果：**
- ✅ 提示："已复制到剪贴板"
- ✅ 粘贴的内容是完整的Markdown
- ✅ 包含图片占位符 `![...](image_N)`

---

### 测试9：重置功能

**步骤：**
1. 点击"重置"按钮

**预期结果：**
- ✅ 文章内容清空
- ✅ 输入框清空
- ✅ 会话重置
- ✅ 提示："已重置会话"

---

## 🔍 详细功能验证

### 验证1：图片理解（千问VL核心功能）

**测试方法：**
选择一个包含**明显主题图片**的文档，例如：
- 产品照片
- 流程图
- 界面截图

**生成指令：**
```
请仔细分析每张图片的内容，然后创作一篇文章，并根据图片内容将它们插入到最合适的位置
```

**验证点：**
1. AI是否真的"理解"了图片内容？
   - 查看图片描述是否准确
   - 例如：`![产品外观图](image_1)` 而不是简单的 `![图片1](image_1)`

2. 图片位置是否合理？
   - 图片应该出现在相关文本附近
   - 不应该随机放置

3. 文本与图片的关联性
   - 文本是否提到了图片中的内容
   - 例如："如上图所示，产品采用了..."

---

### 验证2：智能排版

**测试方法：**
选择一个有**多张图片**的文档（3张以上）

**生成指令：**
```
重新组织这篇文章，把图片智能地插入到最能体现内容的位置
```

**验证点：**
1. 图片分布是否均匀？
2. 是否有"图片堆积"现象？
3. 每张图片是否都有相关文本？

---

### 验证3：飞书文档创建完整性

**测试方法：**
1. 生成一篇包含多种元素的文章：
   - 多级标题
   - 多段文本
   - 多张图片

2. 创建飞书副本

3. 在飞书中逐一检查：

**检查清单：**
- [ ] 一级标题显示正确
- [ ] 二级标题显示正确
- [ ] 三级标题显示正确
- [ ] 普通文本段落完整
- [ ] 所有图片都已导入
- [ ] 图片顺序正确（image_1, image_2, image_3...）
- [ ] 图片清晰度良好
- [ ] 没有多余的空行或格式错误

---

## 🐛 已知问题和解决方案

### 问题1：图片不显示

**现象：**
生成文章后，只看到 `![图片描述](image_1)` 占位符，图片不显示。

**解决方案：**
参考 `图片显示问题调试指南.md`

---

### 问题2：多轮对话500错误

**现象：**
第一次生成成功，第二轮精修时报500错误。

**已修复：**
✅ 已将 `refine` 接口切换到 `AIProvider` 工厂模式
✅ 支持所有AI提供商（Gemini、DeepSeek、千问VL）

**如果还是报错：**
1. 确认后端已重启
2. 查看后端日志的详细错误

---

### 问题3：飞书文档创建失败

**现象：**
点击"创建飞书副本"后，提示"创建文档失败"。

**可能原因：**
- 飞书应用权限不足
- Token过期
- 网络问题

**解决方案：**
1. 检查飞书应用权限：
   - `docx:document` - 创建文档
   - `drive:drive` - 上传文件
   - `docx:document:edit` - 编辑文档
   
2. 重新登录飞书

3. 查看后端日志获取详细错误

---

## 📊 性能测试

### 测试1：生成速度

**测试方法：**
记录从点击"生成"到文章显示的时间

**参考值：**
- 纯文本（无图片）：5-10秒
- 1张图片：10-15秒
- 3张图片：15-30秒
- 5张以上：30-60秒

**如果超过60秒：**
- 检查网络连接
- 检查千问VL API是否正常
- 查看后端日志是否有超时错误

---

### 测试2：飞书文档创建速度

**测试方法：**
记录从点击"创建飞书副本"到成功提示的时间

**参考值：**
- 纯文本：3-5秒
- 1张图片：5-10秒
- 3张图片：10-20秒
- 5张以上：20-40秒

**影响因素：**
- 图片大小
- 网络速度
- 飞书API响应速度

---

## ✅ 完整测试通过标准

如果以下所有项都✅，说明系统运行正常：

### 基础功能
- [ ] 飞书登录成功
- [ ] 文档列表正确显示
- [ ] 文档内容正确加载
- [ ] 文本内容完整显示
- [ ] 图片缩略图正常显示

### AI生成功能
- [ ] 首次生成成功
- [ ] **图片自动显示**（关键！）
- [ ] 图片位置合理
- [ ] 图片描述准确
- [ ] 文章质量良好

### 多轮对话
- [ ] 第2轮精修成功
- [ ] 第3轮精修成功
- [ ] 不会出现500错误
- [ ] 图片持续正常显示

### 导出功能
- [ ] 创建飞书副本成功
- [ ] 飞书文档中文本完整
- [ ] 飞书文档中图片显示
- [ ] 图片位置正确
- [ ] 格式正确美观

### 辅助功能
- [ ] 复制功能正常
- [ ] 重置功能正常
- [ ] 没有明显的性能问题
- [ ] 没有UI显示异常

---

## 🎉 测试总结报告模板

测试完成后，填写以下报告：

```
测试日期：2025-10-04
测试人员：[你的名字]
测试环境：Windows 10 + Chrome

【基础功能】
✅ 飞书登录
✅ 文档加载
✅ 内容显示

【AI生成功能】
✅ 首次生成
⚠️ 图片显示（有问题，见备注）
✅ 文章质量

【多轮对话】
✅ 多轮精修（测试了3轮）
✅ 无500错误

【导出功能】
✅ 创建飞书副本
✅ 图片导入成功
✅ 格式正确

【性能】
生成速度：约15秒（1张图片）
导出速度：约8秒（1张图片）

【问题汇总】
1. [如果有问题，在这里列出]

【总体评价】
[功能正常 / 有minor问题 / 有critical问题]
```

---

**开始测试吧！** 🚀

有任何问题随时告诉我！

