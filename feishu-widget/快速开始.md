# 🚀 飞书文档小组件 - 快速开始

## ✅ 项目已创建完成!

文件结构:
```
feishu-widget/
├── README.md              ✅ 项目说明
├── package.json           ✅ 依赖配置
├── tsconfig.json          ✅ TypeScript配置
├── webpack.config.js      ✅ 打包配置
├── src/
│   ├── index.tsx         ✅ 入口文件
│   ├── App.tsx           ✅ 主界面
│   ├── App.css           ✅ 样式
│   └── services/
│       └── api.ts        ✅ API服务
└── public/
    ├── index.html        ✅ HTML模板
    └── manifest.json     ✅ 飞书配置
```

---

## 📋 下一步操作

### 步骤1: 安装依赖 (5分钟)

```bash
cd feishu-widget
npm install
```

**可能遇到的问题:**
- 如果`npm install`很慢,可以使用国内镜像:
  ```bash
  npm install --registry=https://registry.npmmirror.com
  ```

---

### 步骤2: 配置后端地址 (1分钟)

编辑 `src/services/api.ts`,确认后端地址:
```typescript
const BACKEND_URL = 'http://localhost:8000'; // 你的后端地址
```

**注意:** 后端需要添加CORS配置!

---

### 步骤3: 启动开发服务器 (2分钟)

```bash
npm run dev
```

浏览器会自动打开 `http://localhost:3001`

**你会看到:**
- 📄 文档内容预览
- ✨ AI指令输入框
- 🚀 生成按钮

---

### 步骤4: 配置后端CORS (重要!)

编辑 `backend_py/main.py`,添加CORS配置:

```python
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

# 添加CORS配置
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:3001", "*"],  # 开发环境允许所有来源
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)
```

**然后重启后端:**
```bash
cd backend_py
python main.py
```

---

### 步骤5: 测试功能 (5分钟)

1. ✅ 打开 `http://localhost:3001`
2. ✅ 查看文档内容预览 (当前是模拟数据)
3. ✅ 输入AI指令,例如: "润色"
4. ✅ 点击"生成"按钮
5. ✅ 查看生成结果

**预期结果:**
- 后端应该收到请求并调用QwenVL
- 前端显示生成的内容

---

## 🎯 后续开发步骤

### Phase 1: 本地开发 (当前阶段)
- ✅ 基础UI已完成
- ⏳ 测试后端API调用
- ⏳ 完善错误处理

### Phase 2: 集成飞书SDK (1-2天)
1. 安装飞书SDK:
   ```bash
   npm install @lark-base-open/js-sdk
   ```

2. 替换模拟数据,使用真实飞书API:
   ```typescript
   import { docx } from '@lark-base-open/js-sdk';
   
   // 读取真实文档
   const blocks = await docx.getBlocks();
   const texts = blocks.filter(b => b.type === 'text').map(b => b.content);
   ```

3. 实现内容插入:
   ```typescript
   // 插入生成的内容
   await docx.insertBlock({
     type: 'text',
     content: result.content,
     position: 'end'
   });
   ```

### Phase 3: 飞书应用配置 (1天)
1. 登录飞书开发者后台: https://open.feishu.cn/app
2. 创建 "文档小组件" 类型应用
3. 配置权限:
   - docx:read - 读取文档
   - docx:write - 编辑文档
4. 配置回调地址
5. 记录 App ID 和 App Secret

### Phase 4: 构建和部署 (1天)
1. 构建生产版本:
   ```bash
   npm run build
   ```

2. 上传到飞书:
   - 进入开发者后台
   - 上传 `dist/` 目录
   - 提交审核

---

## 🐛 常见问题

### Q1: npm install失败?
**A:** 尝试使用国内镜像或cnpm:
```bash
npm install --registry=https://registry.npmmirror.com
```

### Q2: CORS错误?
**A:** 确保后端已添加CORS配置,并重启后端服务。

### Q3: 后端无法访问?
**A:** 检查:
1. 后端是否正常运行 (http://localhost:8000)
2. 后端CORS配置是否正确
3. 前端API地址是否正确

### Q4: 如何调试?
**A:** 
- 前端: 浏览器F12 → Console查看日志
- 后端: 查看命令行输出

---

## 📚 参考资料

- [飞书开放平台](https://open.feishu.cn/)
- [飞书文档小组件开发指南](https://open.feishu.cn/document/uAjLw4CM/ukTMukTMukTM/block/guide/block-introduction)
- [React官方文档](https://react.dev/)
- [Ant Design组件库](https://ant.design/)

---

## 💡 下一步建议

**立即测试:**
1. 安装依赖: `cd feishu-widget && npm install`
2. 配置后端CORS
3. 启动前端: `npm run dev`
4. 测试AI生成功能

**告诉我测试结果,我会继续帮你完善! 🚀**

