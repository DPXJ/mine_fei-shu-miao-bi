# 🚀 飞书文档小组件 - 快速测试指南

## 📋 测试前准备

### 1. 确保后端服务运行

```bash
# 终端1: 启动后端
cd backend_py
python main.py

# 确认后端启动成功
# 访问: http://localhost:8000/docs
```

### 2. 安装小组件依赖

```bash
# 终端2: 安装依赖
cd feishu-widget
npm install

# 如果安装失败，使用国内镜像:
npm install --registry=https://registry.npmmirror.com
```

## 🧪 测试步骤

### 步骤1: 启动小组件

```bash
# 在feishu-widget目录下
npm run dev
```

**预期结果:**
- 浏览器自动打开 http://localhost:3001
- 显示"AI文档助手"界面
- 环境提示显示"开发模式"

### 步骤2: 测试文档读取

**操作:** 页面加载完成后，查看文档预览区域

**预期结果:**
- 显示"📄 当前文档"卡片
- 显示"2 段文本"和"2 张图片"标签
- 显示模拟文档内容预览

### 步骤3: 测试AI生成

**操作:**
1. 在"AI指令"输入框中输入: `请帮我润色这段内容`
2. 点击"✨ 生成内容"按钮

**预期结果:**
- 按钮显示"生成中..."
- 3-10秒后显示生成结果
- 出现"✅ 生成结果"卡片
- 显示AI生成的文章内容

### 步骤4: 测试多轮对话

**操作:**
1. 在生成结果后，修改指令为: `请让内容更专业一些`
2. 点击"🔄 优化内容"按钮

**预期结果:**
- 按钮显示"优化中..."
- 生成结果更新为新内容
- 显示"内容已优化!"消息

### 步骤5: 测试复制功能

**操作:** 点击"📋 复制内容"按钮

**预期结果:**
- 显示"开发模式：内容已显示在下方，可手动复制"
- 内容可以手动选择复制

## ✅ 功能测试清单

### 基础功能
- [ ] 页面正常加载
- [ ] 文档内容读取正常 (模拟数据)
- [ ] AI生成功能正常
- [ ] 生成结果正确显示
- [ ] 多轮对话优化正常
- [ ] 复制功能正常

### UI交互
- [ ] 预设指令按钮可点击
- [ ] 输入框字符计数正常
- [ ] 加载状态显示正确
- [ ] 错误提示显示正确
- [ ] 按钮状态切换正常

### 错误处理
- [ ] 空指令输入有提示
- [ ] 网络错误有提示
- [ ] 后端服务断开有提示

## 🔍 调试信息

### 浏览器控制台检查

按F12打开开发者工具，查看Console:

**正常日志:**
```
已加载模拟文档内容
API调用成功
内容已生成!
```

**错误日志示例:**
```
API调用失败: Network request failed
读取文档失败: Permission denied
```

### 网络请求检查

在Network标签中查看API请求:

**正常请求:**
```
POST http://localhost:8000/api/ai/create
Status: 200 OK
Response: {"session_id": "xxx", "content": "xxx"}
```

**异常请求:**
```
POST http://localhost:8000/api/ai/create
Status: 500 Internal Server Error
```

## 🐛 常见问题解决

### 问题1: 页面无法加载

**症状:** 访问 http://localhost:3001 显示空白页

**解决方案:**
```bash
# 检查端口占用
netstat -ano | findstr :3001

# 重新启动
npm run dev
```

### 问题2: AI生成失败

**症状:** 点击生成按钮后显示"生成失败"

**解决方案:**
1. 检查后端服务是否启动: http://localhost:8000/docs
2. 检查CORS配置
3. 查看后端日志

### 问题3: 依赖安装失败

**症状:** npm install 报错

**解决方案:**
```bash
# 清理缓存
npm cache clean --force

# 使用国内镜像
npm install --registry=https://registry.npmmirror.com

# 删除node_modules重试
rm -rf node_modules
npm install
```

### 问题4: 飞书SDK导入错误

**症状:** 控制台显示模块导入错误

**解决方案:**
```bash
# 确认SDK版本
npm list @lark-base-open/js-sdk

# 重新安装
npm uninstall @lark-base-open/js-sdk
npm install @lark-base-open/js-sdk@latest
```

## 📊 性能测试

### 响应时间测试

**测试指标:**
- 页面加载时间: < 2秒
- AI生成响应时间: 3-10秒
- 多轮对话响应时间: 2-8秒

### 内存使用测试

**监控指标:**
- 页面内存占用: < 50MB
- 长时间使用无内存泄漏

## 🎯 下一步测试

### 飞书环境测试

1. 部署到服务器
2. 配置飞书应用
3. 在真实飞书文档中测试

### 生产环境测试

1. 构建生产版本
2. 性能优化测试
3. 用户体验测试

---

**🎉 测试完成后，小组件就可以部署到飞书环境了！**
