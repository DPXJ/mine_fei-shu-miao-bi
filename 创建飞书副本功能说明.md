# ✅ 新功能：创建飞书副本

## 🎉 功能说明

现在你可以一键将AI生成的文章导出到飞书文档！

---

## 🚀 使用步骤

### 步骤1：生成文章

1. 访问 http://localhost:3000
2. 登录飞书
3. 选择一个包含图片的文档
4. 输入创作指令，生成文章

### 步骤2：创建飞书副本

1. 在生成的文章右上角，找到 **"创建飞书副本"** 按钮（蓝色主按钮）
2. 点击按钮
3. 等待创建完成（会显示"正在创建飞书文档..."）
4. 弹出成功提示框，点击链接直接打开新文档

---

## ✨ 功能特点

### 1. **完整内容导出**
- ✅ 导出所有文本内容
- ✅ 导出所有图片（自动上传到飞书）
- ✅ 保留文章结构（标题、段落）
- ✅ 图片位置保持与AI排版一致

### 2. **自动格式转换**
- Markdown标题 → 飞书标题块
- Markdown文本 → 飞书文本块
- `![描述](image_N)` → 飞书图片块

### 3. **智能命名**
- 新文档标题：`原文档名 - AI创作副本`
- 例如：`产品介绍 - AI创作副本`

### 4. **一键打开**
- 创建成功后弹出提示框
- 点击链接直接在浏览器中打开飞书文档
- 无需手动搜索

---

## 📊 工作流程

```
用户点击"创建飞书副本"
  ↓
前端发送请求（文章内容 + 图片数据）
  ↓
后端创建新的飞书文档
  ↓
后端上传所有图片到飞书
  ↓
后端解析Markdown，转换为飞书blocks
  ↓
后端批量写入文档内容
  ↓
返回文档ID和URL
  ↓
前端显示成功提示 + 打开链接
```

---

## 🎯 示例

### 原始AI生成内容（Markdown）：

```markdown
# 产品介绍

我们的产品具有以下特点...

![产品外观图](image_1)

从上图可以看出...

## 核心功能

功能介绍...

![功能演示图](image_2)

如图所示...
```

### 导出到飞书后：

- **文档标题**：`产品介绍 - AI创作副本`
- **内容结构**：
  - 一级标题："产品介绍"
  - 文本段落："我们的产品具有以下特点..."
  - 图片块：显示产品外观图
  - 文本段落："从上图可以看出..."
  - 二级标题："核心功能"
  - 文本段落："功能介绍..."
  - 图片块：显示功能演示图
  - 文本段落："如图所示..."

---

## ⚙️ 技术实现

### 后端API (`backend_py/routers/documents.py`)

**新增接口：**
```
POST /api/documents/create
```

**功能：**
1. 创建新的飞书文档
2. 上传图片到飞书（获取file_token）
3. 解析Markdown内容
4. 转换为飞书block格式
5. 批量写入blocks到文档

### 前端服务 (`frontend/src/services/documents.ts`)

**新增方法：**
```typescript
async createFeishuCopy(
  title: string,
  content: string,
  images: Array<{mime_type: string; data: string}>
)
```

### 前端UI (`frontend/src/components/EditorWorkspace.tsx`)

**新增功能：**
- ✅ "创建飞书副本"按钮
- ✅ `handleCreateFeishuCopy` 处理函数
- ✅ 加载提示（message.loading）
- ✅ 成功提示（Modal.success + 文档链接）

---

## ⚠️ 注意事项

### 1. **权限要求**
需要飞书应用有以下权限：
- ✅ 创建文档（`docx:document`）
- ✅ 上传文件（`drive:drive`）
- ✅ 写入blocks（`docx:document:edit`）

### 2. **图片数量限制**
- 目前一次最多支持100个blocks
- 如果文章太长，可能需要分批创建

### 3. **格式支持**
目前支持：
- ✅ 一级标题（`#`）
- ✅ 二级标题（`##`）
- ✅ 三级标题（`###`）
- ✅ 普通文本
- ✅ 图片

暂不支持：
- ❌ 表格
- ❌ 代码块
- ❌ 引用块
- ❌ 列表（待扩展）

### 4. **网络要求**
- 创建文档需要调用飞书API
- 图片上传可能需要较长时间
- 建议网络稳定时使用

---

## 🐛 故障排除

### 问题1：点击按钮没反应
**解决方案：**
1. 检查浏览器Console是否有错误
2. 确认已生成文章（article不为空）
3. 刷新页面重试

### 问题2：创建失败，提示"创建文档失败"
**可能原因：**
- 飞书应用权限不足
- Token过期
- 网络问题

**解决方案：**
1. 检查后端日志（运行`python backend_py/main.py`的终端）
2. 确认飞书应用权限已正确配置
3. 重新登录飞书

### 问题3：文档创建成功，但图片没有显示
**可能原因：**
- 图片上传失败
- 图片token获取失败

**解决方案：**
1. 查看后端日志，找到图片上传的错误信息
2. 确认图片格式（目前仅支持JPEG）
3. 检查飞书存储空间是否充足

### 问题4：文档链接打不开
**解决方案：**
1. 复制链接到浏览器地址栏打开
2. 确认已登录飞书网页版
3. 等待几秒后刷新页面

---

## 🎉 开始使用

1. **确保后端和前端都在运行**
   - 后端：http://localhost:8000
   - 前端：http://localhost:3000

2. **生成一篇文章**
   - 选择文档 → 输入指令 → 生成

3. **点击"创建飞书副本"**
   - 等待创建完成
   - 点击链接打开文档

4. **在飞书中查看**
   - 文章内容完整导入
   - 图片正确显示
   - 格式清晰美观

---

## 💡 使用技巧

### 技巧1：命名文档
如果想自定义文档名称，可以：
- 先创建文档
- 在飞书中重命名

### 技巧2：多次创建
- 可以多次点击"创建飞书副本"
- 每次都会创建一个新文档
- 不会覆盖之前的文档

### 技巧3：精修后再导出
- 先进行多轮精修，完善文章
- 最后再创建飞书副本
- 确保导出的是最终版本

### 技巧4：保存记录
- 创建成功后，复制文档链接
- 保存到本地，方便后续访问
- 或在飞书中收藏文档

---

**快去试试吧！** 🚀✨

有问题随时告诉我！

