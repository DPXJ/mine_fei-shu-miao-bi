# 📸 图片理解和智能排版功能说明

## 🎯 核心功能

本项目现在支持 **AI理解图片内容** 和 **智能排版**功能！

### ✨ 主要特性

1. **多模态AI理解**
   - AI能够"看懂"图片内容
   - 分析图片主题、信息和与文本的关联性
   
2. **智能排版**
   - 根据图片内容和文本的关联性
   - 自动将图片插入到文章最合适的位置
   - 文字与图片协同表达，逻辑连贯

3. **预览功能**
   - 一键预览重新排版后的文章
   - 图片实时渲染，所见即所得
   - 支持返回编辑继续优化

---

## 🤖 AI提供商选择

### 方案一：DeepSeek（当前默认）✅
- ✅ **国内直接可用**，无需VPN
- ❌ **仅支持文本**，不支持图片理解
- 💰 价格实惠，速度快

**适用场景**：纯文本内容优化、不需要图片理解

### 方案二：Google Gemini 1.5 Pro（推荐）⭐
- ✅ **支持图片理解**
- ✅ **智能排版**功能完整
- ❌ **需要VPN**（国内访问受限）
- 💡 效果最好

**适用场景**：需要图片理解和智能排版

### 方案三：阿里千问VL（推荐国内用户）⭐⭐
- ✅ **支持图片理解**
- ✅ **智能排版**功能完整
- ✅ **国内直接可用**，无需VPN
- 💰 价格合理

**适用场景**：国内用户，需要图片理解和智能排版

---

## 🔧 配置方法

### 方法一：使用Gemini（需要VPN）

1. **保持VPN连接**
2. **修改 `backend_py/main.py`**：
```python
os.environ["AI_PROVIDER"] = "gemini"  # 从 "deepseek" 改为 "gemini"
```
3. **重启后端服务**

### 方法二：使用千问VL（推荐国内用户）

1. **获取千问API Key**：
   - 访问：https://dashscope.console.aliyun.com/
   - 注册/登录阿里云账号
   - 开通"灵积模型服务"
   - 创建API Key

2. **修改 `backend_py/main.py`**：
```python
os.environ["QWEN_API_KEY"] = "你的千问API_Key"
os.environ["AI_PROVIDER"] = "qwen"
```

3. **重启后端服务**

### 方法三：继续使用DeepSeek（仅文本）

无需任何修改，当前已配置完成。

---

## 📋 使用步骤

### 1. 启动项目

```bash
# 后端
cd backend_py
python main.py

# 前端（新终端）
cd frontend
npm run dev
```

### 2. 创建文章

1. 登录并选择一个包含图片的飞书文档
2. 在编辑器中输入创作指令，例如：
   - "帮我重新排版这篇文章，把图片放在最合适的位置"
   - "根据图片内容，创作一篇图文并茂的文章"
   - "优化文章结构，合理插入图片"

3. 点击"生成"按钮

### 3. 预览排版

1. 文章生成后，点击右上角的 **"预览排版"** 按钮
2. 系统会：
   - ✅ 分析每张图片的内容
   - ✅ 将图片智能插入到最合适的位置
   - ✅ 渲染完整的图文混排效果

3. 支持：
   - 📄 预览：查看最终排版效果
   - ✏️ 返回编辑：继续优化
   - 📋 复制：复制Markdown内容
   - 🔄 重置：重新开始

---

## 💡 使用建议

### 最佳实践

1. **选择合适的AI提供商**：
   - 有VPN → 选择Gemini（效果最好）
   - 无VPN + 需要图片理解 → 选择千问VL
   - 纯文本 → 继续使用DeepSeek

2. **优化创作指令**：
   - ✅ "根据图片内容，创作一篇关于XX的文章，并合理排版"
   - ✅ "请分析每张图片，将它们插入到最合适的段落位置"
   - ❌ "帮我写一篇文章"（太笼统）

3. **多轮对话精修**：
   - 首次生成后，可以继续输入指令优化
   - 例如："把第二张图片移到第一段后面"
   - 例如："图片3的位置不太合适，请调整"

### 示例对话

**用户**：根据这些图片和文字，创作一篇产品介绍文章，图片要放在最合适的位置

**AI**（Gemini/千问VL）：
```markdown
# 产品介绍标题

产品的开场白文字内容...

![产品外观图](image_1)

接下来介绍产品特性...

![功能演示图](image_2)

继续详细说明...
```

**用户**：第二张图片应该放在开头，请调整

**AI**：已为您调整图片位置...

---

## 🔍 技术实现

### 后端

1. **多模态AI提供商接口** (`backend_py/ai_provider.py`)：
   - `GeminiProvider`: 支持图片理解
   - `DeepSeekProvider`: 仅文本
   - `QwenVLProvider`: 支持图片理解（国内可用）

2. **图片下载和处理**：
   - 从飞书API下载图片
   - 转换为base64编码
   - 传递给AI模型

3. **智能排版逻辑**：
   - AI分析图片内容
   - 根据语义关联性插入图片
   - 输出带图片占位符的Markdown

### 前端

1. **预览功能** (`frontend/src/components/EditorWorkspace.tsx`)：
   - `handlePreview()`: 加载预览数据
   - `renderArticleWithImages()`: 渲染图文内容
   - 替换 `![...](image_N)` 为实际图片

2. **图片渲染**：
   - 支持base64图片直接显示
   - 响应式布局
   - Markdown渲染

---

## 📊 功能对比

| 功能 | DeepSeek | Gemini | 千问VL |
|------|----------|---------|--------|
| 文本理解 | ✅ | ✅ | ✅ |
| 图片理解 | ❌ | ✅ | ✅ |
| 智能排版 | ❌ | ✅ | ✅ |
| 国内访问 | ✅ | ❌需要VPN | ✅ |
| 速度 | ⚡快 | 🐢较慢 | ⚡快 |
| 价格 | 💰便宜 | 💰💰中等 | 💰💰中等 |

---

## ❓ 常见问题

### Q1: 为什么DeepSeek不支持图片理解？
A: DeepSeek目前是纯文本模型，不支持多模态输入。如需图片理解，请切换到Gemini或千问VL。

### Q2: 千问VL和Gemini效果差别大吗？
A: 两者效果都很好，千问VL在中文理解上可能略有优势，Gemini在复杂图片分析上可能更强。建议都尝试一下。

### Q3: 图片占位符是什么格式？
A: 格式为 `![图片描述](image_N)`，其中N是图片编号（从1开始）。在预览模式下会自动替换为实际图片。

### Q4: 可以生成新的飞书文档吗？
A: 目前暂不支持直接生成飞书文档。您可以：
1. 使用"复制"功能复制Markdown内容
2. 手动粘贴到飞书文档
3. 后续版本会添加此功能

### Q5: 如何获取千问API Key？
A: 
1. 访问 https://dashscope.console.aliyun.com/
2. 注册/登录阿里云账号
3. 开通"灵积模型服务"（有免费额度）
4. 在控制台创建API Key

---

## 🚀 未来计划

- [ ] 支持更多AI模型（GPT-4 Vision等）
- [ ] 直接生成飞书文档功能
- [ ] 图片编辑和裁剪功能
- [ ] 批量处理多个文档
- [ ] 自定义排版模板

---

## 📞 技术支持

如有问题，请查看：
1. 后端日志：运行后端时的控制台输出
2. 前端日志：浏览器F12 Console
3. `AI配置说明.md`：详细的AI配置指南

**享受智能创作的乐趣！** 🎉

