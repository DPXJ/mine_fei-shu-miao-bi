# ✅ 千问VL已配置完成！

## 🎉 配置状态

- ✅ **千问API Key已配置**：`sk-8dea6d7ed4864155a0fa33433c5c58a4`
- ✅ **AI提供商已切换**：从 DeepSeek → 千问VL
- ✅ **后端服务已启动**：http://localhost:8000
- ✅ **支持图片理解**：千问VL可以"看懂"图片内容
- ✅ **智能排版功能**：AI会根据图片与文本关联性自动排版

---

## 🚀 现在可以测试了！

### 第一步：确认后端正在运行

你应该能看到后端输出类似：
```
INFO: Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
```

如果没有运行，执行：
```bash
cd backend_py
python main.py
```

### 第二步：启动前端

在新的终端窗口：
```bash
cd frontend
npm run dev
```

### 第三步：访问应用

打开浏览器，访问：**http://localhost:3000**

---

## 🎯 测试图片理解功能

### 1. 登录飞书

- 点击"使用飞书登录"
- 授权应用访问文档

### 2. 选择包含图片的文档

在文档列表中，**选择一个包含图片的飞书文档**

### 3. 输入创作指令（关键！）

**推荐的创作指令**：

```
根据图片内容，创作一篇图文并茂的文章，合理安排图片位置
```

或者：

```
请分析每张图片的内容，然后创作一篇产品介绍，将图片插入到最合适的位置
```

或者：

```
帮我重新排版这篇文章，把图片根据内容放在最合适的地方
```

### 4. 点击"生成"

这时候，后端日志应该会显示：
```
Using AI Provider: qwen
Calling Qwen VL API... (timeout=60s, images=X)
Added image 1 to content
Added image 2 to content
...
Qwen VL API response received successfully
```

### 5. 查看生成结果

AI生成的文章中会包含图片占位符，例如：
```markdown
# 文章标题

开头的介绍内容...

![产品外观图](image_1)

继续介绍产品特性...

![功能演示图](image_2)

详细说明...
```

### 6. 点击"预览排版"

点击右上角的 **"预览排版"** 按钮，你会看到：
- ✅ 图片实时渲染显示
- ✅ 文字与图片完美混排
- ✅ 图片位置根据内容智能安排

---

## 🔍 验证千问VL是否正常工作

### 方法一：查看后端日志

当你点击"生成"时，后端应该显示：
```
Using AI Provider: qwen
Calling Qwen VL API... (timeout=60s, images=3)
Added image 1 to content
Added image 2 to content
Added image 3 to content
Qwen VL API response received successfully
```

**如果看到这些日志，说明千问VL正在工作！**

### 方法二：检查生成效果

**千问VL的特点**：
- ✅ AI会分析图片内容
- ✅ 在生成的文章中，图片位置与相关文本紧密关联
- ✅ 图片描述准确（例如：`![产品外观图](image_1)` 而不是简单的 `![图片1](image_1)`）

---

## 💡 使用技巧

### 最佳实践

1. **选择图文并茂的文档**
   - 包含3-10张图片的文档效果最好
   - 图片内容清晰、有主题

2. **明确的创作指令**
   - ✅ "根据图片内容，创作产品介绍，合理排版"
   - ✅ "分析图片，将它们插入到最合适的段落"
   - ❌ "写一篇文章"（太笼统）

3. **多轮对话优化**
   - 生成后可以继续优化
   - 例如："把第二张图片移到开头"
   - 例如："为第三张图片增加更详细的说明"

### 示例对话

**用户**：根据这些图片和文字，创作一篇产品介绍，图片要放在最合适的位置

**AI（千问VL）**：
```markdown
# XX产品全面介绍

我们的产品结合了创新设计与卓越性能...

![产品整体外观展示](image_1)

从上图可以看出，产品采用了简约现代的设计风格...

## 核心功能

产品的核心功能包括...

![功能界面演示](image_2)

如图所示，用户界面简洁直观...

## 技术优势

在技术层面，我们实现了...

![技术架构图](image_3)

技术架构保证了系统的稳定性和扩展性...
```

---

## ⚠️ 常见问题

### Q1: 后端显示"QWEN_API_KEY environment variable is not set"

**A:** 说明配置没生效，请：
1. 确认 `backend_py/main.py` 第24行包含你的API Key
2. 重启后端服务

### Q2: 生成时显示"不支持图片理解"

**A:** 说明还在使用DeepSeek，检查：
1. `backend_py/main.py` 第25行是否是 `os.environ["AI_PROVIDER"] = "qwen"`
2. 是否重启了后端

### Q3: API调用失败，显示401错误

**A:** API Key可能有问题：
1. 确认API Key是否正确复制
2. 检查千问账户余额是否充足
3. 确认API Key是否已激活

### Q4: 图片不显示在预览中

**A:** 可能的原因：
1. 飞书图片下载失败
2. 网络问题
3. 查看后端日志中的错误信息

### Q5: 想切换回DeepSeek怎么办？

**A:** 修改 `backend_py/main.py` 第25行：
```python
# 注释掉千问
# os.environ["AI_PROVIDER"] = "qwen"

# 取消注释DeepSeek
os.environ["AI_PROVIDER"] = "deepseek"
```
然后重启后端。

---

## 📊 功能对比

| 功能 | DeepSeek（之前） | 千问VL（现在） |
|------|-----------------|---------------|
| 文本理解 | ✅ | ✅ |
| 图片理解 | ❌ | ✅ |
| 智能排版 | ❌ | ✅ |
| 国内访问 | ✅ | ✅ |
| 速度 | ⚡快 | ⚡快 |

---

## 🎉 开始体验吧！

现在你可以：
1. ✅ AI能"看懂"图片内容
2. ✅ 根据图片与文本关联性智能排版
3. ✅ 创作高质量的图文并茂文章
4. ✅ 无需VPN，国内直接可用

**赶快测试一下图片理解和智能排版功能吧！** 🚀

---

## 📞 如需帮助

如果遇到问题：
1. 查看后端日志（运行后端的终端）
2. 查看前端日志（浏览器F12 Console）
3. 参考 `千问VL配置指南.md` 获取详细帮助

**祝创作愉快！** ✨

